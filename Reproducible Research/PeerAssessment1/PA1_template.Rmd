# Reproducible Research: Peer Assessment 1


## Loading and preprocessing the data

The code checks for the existance of the `activity.csv` in the working directory. If the file does not exist the script checks for `activity.zip` and inzips the file. If the `activity.zip` does not exist the code downloads the .zip file unzips it adn reads the data from `activity.csv` If there is a problem with the internet connection `download.file` throws a message `method = "internla"` beacsue the `URL = https`

````{r}
library(lattice)
library(chron)

fileURL <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip"
destFile <- "activity.zip"
dataFile <- "activity.csv"
if (!file.exists(dataFile)) {
        if (!file.exists(destFile)) {
                download.file (fileURL, destFile, method = "internal")
        }
        unzip(destFile)
}  

data <- read.csv(file = dataFile, header = TRUE)
data$date <- as.Date(data$date, format = "%Y-%m-%d")

data$interval <- sprintf("%04d", data$interval)
data$interval <- as.POSIXct(data$interval, format = "%H%M")

data <- data[, c("date", "interval", "steps")]

head(data, n = 6)
tail(data, n = 6)
```

## What is mean total number of steps taken per day?

At first the code sumes up the number of steps for every day. Consequently the mean and median of this total number of steps per day is calculated in `mean` and `median` variables.

```{r}
daylytotal <- tapply(data$steps, factor(data$date), sum, na.rm = TRUE)

mean <- mean(daylytotal)

median <- median(daylytotal)

mean 
median
``` 

The `mean` total number of steps per day is **`r mean`** and the `median` total number of steps per day is **`r median`**.

The histogram of the toatl number of steps per day is: 

```{r}
histogram(daylytotal, breaks = 25, type = "count", col = "NA", 
                      xlab = "Total steps per day",
                      ylab = "Frequency")
``` 

## What is the average daily activity pattern?

The code calculates the avedarage steps per day, plots the steps with respect to the intervals and finds out the interval with maximum average steps.

```{r}
df <- aggregate(data, list(data$interval), mean, na.rm = TRUE)
df <- df[, c("interval","steps")]
        
plot (df$interval, df$steps, type = "l",  xlab = "Interval", 
                                        ylab = "Average steps")
maxsteps <- which(df$steps == max(df$steps))
maxSteps <- df[maxsteps, c("interval", "steps")]
maxSteps <- transform(maxSteps, interval = strftime(interval, format="%H:%M:%S"))
maxSteps
```

The maximum average steps per interval si ***`r maxSteps$steps`*** and they are during the time interval of ***`r maxSteps$interval`*** in the morning.

## Imputing missing values

The code inputs missing values in the data.frame with the average value for the specific interval in which` the missing values` value occurs. Afterwords, are calculated the total number of steps the meadn and the median per day. The data is compared with the the results before replacing `the missing values`

```{r}
totalNA <- sum(is.na(data))
        
stepsList <- split(data$steps, factor(data$interval))
stepsList <- lapply(stepsList, 
        function(stepsList){
                stepsList[which(is.na(stepsList))] <- mean(stepsList, na.rm = TRUE)
                stepsList
        })
        
fillData <- data
fillData$steps <- unsplit(stepsList, factor(fillData$interval)) 
        
fillDaylyTotal <- tapply(fillData$steps, factor(fillData$date), sum, na.rm = TRUE)
daylyTotal <- tapply(data$steps, factor(data$date), sum, na.rm = TRUE)
        
par(mfrow = c(2,1), mar = c(4,4,2,1), oma = c(0,0,2,0))
        
hist(daylyTotal, breaks = 25, xlab = "Total steps per day", 
                              main = "Data with NA values")
hist(fillDaylyTotal, breaks = 25, xlab = "Total steps per day",
                                  main = "NA values substituted with interval means")
        
fillMean <- mean(fillDaylyTotal)
fillMedian <- median(fillDaylyTotal)
```

As shown in the graph the total number of steps per day is expectingly incresed after replasing `the missing values` with the interval's average value. This makes the distribution steeper wuth better expreseed meand value. However the increse in mean and median values after replacing `the missing values` is relatively small:

1. Mean value ***`before`*** NA replacement : `r mean`
2. Mean value ***`after`***  NA replacement : `r fillMean`
3. Median value ***`before`*** NA replacement : `r median`
4. Median value ***`after`***  NA replacement : `r fillMedian`

## Are there differences in activity patterns between weekdays and weekends?

The code calculates the average steps per interval for each group of days `weekdays` and `weekends`. Furhtermore, the data is processed in a format convenient for `xyplot` plotting function from `lattice` package.

```{r}
fDays<- factor((weekdays(data$date) %in% c('Saturday','Sunday')), 
                       labels = c("weekdays", "weekends"))
        
lDaysSteps <- split(fillData, fDays)
lDaysSteps <- lapply(lDaysSteps, 
                        function(x){
                                aggregate(x, list(x$interval), mean, na.rm = TRUE)
                        })
        
par(mfrow = c(2,1), mar = c(3,3,2,1), oma = c(0,0,2,0))

with(lDaysSteps[[2]], plot (Group.1, steps, type = "l", xlab = "Intervals", 
                                                        ylab = "Average steps",
                                                        main = "Weekend",
                                                        ylim = c(0, 200)))
        
with(lDaysSteps[[1]], plot (Group.1, steps, type = "l", xlab = "Intervals", 
                                                        ylab = "Average steps",
                                                        main = "Weekdays"))
weekendTotal <- sum(lDaysSteps[[2]]$steps)
weekTotal <- sum(lDaysSteps[[1]]$steps)
```

From the plots presented above it becomes evident that in the weekend the average number of steps in the different periods is more even during the day compared with the week days. There is a very well defined peak in the average number of steps before 9:00 am and few smaller peacks around lunch and before the end of the working day. However, it seems the area under the weekends' line is larger in comparison with the area under weekdays'line proposing the total number of steps is larger in the weekends, namely:

1. The total number of steps in the ***`weekend`*** is: `r weekendTotal`  
2. The total number of steps in the ***`weekdays`*** is: `r weekTotal`

This proves that the subjects do more steps in the weekend in comparison with the weekdays.